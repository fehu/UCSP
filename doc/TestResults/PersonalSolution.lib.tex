\documentclass{standalone}

\usepackage{tikz, ifthen, etoolbox, pdftexcmds, loops}
\usetikzlibrary{fit, matrix, positioning, shapes, decorations.pathreplacing,
                shapes.geometric, chains, arrows, calc }

\newcommand{\timetable}[2][]{
  \gdef\mrows{}
  \foreach \h in {8,...,21}
  \foreach \m in {0, 30}
  {
    \ifthenelse{\m = 0}
      { \xappto{\mrows}{\h:00--\h:30 \&} }
      {
        \pgfmathsetmacro{\hh}{int(\h+1)}
        \xappto{\mrows}{\h:30--\hh:00 \&}
      }
    \foreach \i in {1,...,6}
      {\ifthenelse{\i = 6}
        {\xappto{\mrows}{\noexpand\\}}
        {\xappto{\mrows}{\&}}}
  }
  \matrix[matrix of nodes, nodes in empty cells,
          ampersand replacement=\&,
          row sep=-\pgflinewidth, column sep=-\pgflinewidth,
          nodes={draw, text depth=-0.3ex, text height=1.2ex},
          column 1/.style={minimum width=2.1cm},
          row 1/.style={font=\bf},
          minimum width=1.5cm,
          #1] (#2)
  {Time \& Mon \& Tue \& Wed \& Thu \& Fri \& Sat \\ \mrows};
}


\newcommand{\putClass}[3]{
  \def\m{#1}
  \numdef\day{#2+1}
  \foreach \start/\end/\text/\style in {#3}
    % {node[fit = (\m-\start-\day) (\m-\end-\day), class, \style] \{\text\};}
    \node[fit = (\m-\start-\day) (\m-\end-\day), class, \style] {\text};
}

\def\parseMinutes#1{\ifnum\pdfstrcmp{#1}{00}=0
                      0
                    \else \ifnum\pdfstrcmp{#1}{30}=0
                            1
                          \else
                            \errmessage{Incorrect time minutes: #1}
                          \fi
                    \fi
}

\def\parseTime(#1:#2){%
  \pgfmathsetmacro{\res}{int(#1-6+\parseMinutes{#2})}%
  \res%
}

\def\parseClassBegins(#1-#2){\parseTime(#1)}
\def\parseClassEnds(#1-#2){\parseTime(#2)}

\newcommand{\class}[3]{
  \def\m{#1}
  \numdef\day{#2+1}
  \let\acc\empty
  \let\n 0
  \foreach \time/\text/\style [count=\i] in {#3}
    {\numgdef\n\i}
  \foreach \time/\text/\style [count=\i] in {#3}
    {
    \expandafter\xappto\expandafter\acc\expandafter{%
        \expandafter\expandonce\expandafter{%
          \expandafter\parseClassBegins\expandafter(\time)}}
    \xappto\acc{/}
    \expandafter\xappto\expandafter\acc\expandafter{%
        \expandafter\expandonce\expandafter{%
          \expandafter\parseClassEnds\expandafter(\time)}}
    \xappto\acc{/\text/\style}
    \ifnum \i=\n \else \xappto\acc, \fi
    }

    \acc

}


\begin{document}
  \begin{tikzpicture}[
      class/.style={inner sep=0pt, draw, double, fill=white},
    ]
    \timetable{T}

  \end{tikzpicture}

  \class{}{}{8:00-9:00/AA/}

\end{document}
