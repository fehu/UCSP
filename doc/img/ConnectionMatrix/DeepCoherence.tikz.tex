\documentclass[../../header]{subfiles}

\providecommand{\rootdir}{../..}
\input{\rootdir/img/ConnectionMatrix.tikz}


\begin{document}

\newcommand*{\drawMatrix}[2][]{
  \def\d{#2}
  \connectionsMatrix[#1]{m\d};
  \node[draw, color=blue, circle, thick, inner sep=5pt] at (m\d-5-1) {};
  \node[left=3pt of m\d, text width=3cm, align=center]
  {External coherence\\ of \underline{depth $\d$}\\ for candidate $\tilde{c_i}$};
}

\begin{tikzpicture}

\def\colorA{blue}
\def\colorB{green!50!black}
\def\colorC{orange!50!black}
\def\colorD{red}
\def\colorE{magenta!50!black}
\def\colorF{yellow!50!black}

% External coherence of depth 0
\drawMatrix{0}
\fith{m0}{5}{\colorA}

% External coherence of depth 1
\drawMatrix[below=of m0]{1}
\fith[dotted]{m1}{5}{\colorA}
\fitv{m1}{2}{\colorB}
\fitv{m1}{4}{\colorB}
\fitv{m1}{5}{\colorB}

% External coherence of depth 2
\drawMatrix[below=of m1]{2}
\fitv[dotted]{m2}{2}{\colorB}
\fitv[dotted]{m2}{4}{\colorB}
\fitv[dotted]{m2}{5}{\colorB}
\usedv{m2}{2}{\colorB}
\usedv{m2}{4}{\colorB}
\usedv{m2}{5}{\colorB}

\fith{m2}{3}{\colorC}
\fith{m2}{6}{\colorC}
\fith{m2}{7}{\colorC}

% External coherence of depth 3
\drawMatrix[below=of m2]{3}
\fith[dotted]{m3}{3}{\colorC}
\fith[dotted]{m3}{6}{\colorC}
\fith[dotted]{m3}{7}{\colorC}
\usedv{m3}{2}{\colorB}
\usedv{m3}{4}{\colorB}
\usedv{m3}{5}{\colorB}
\usedh{m3}{3}{\colorC}
\usedh{m3}{6}{\colorC}
\usedh{m3}{7}{\colorC}

\fitv{m3}{6}{\colorD}
\fitv{m3}{7}{\colorD}
\fitv{m3}{8}{\colorD}


% External coherence of depth 4
\drawMatrix[below=of m3]{4}
\fitv[dotted]{m4}{6}{\colorD}
\fitv[dotted]{m4}{7}{\colorD}
\fitv[dotted]{m4}{8}{\colorD}
\usedv{m4}{2}{\colorB}
\usedv{m4}{4}{\colorB}
\usedv{m4}{5}{\colorB}
\usedh{m4}{3}{\colorC}
\usedh{m4}{6}{\colorC}
\usedh{m4}{7}{\colorC}
\usedv{m4}{6}{\colorD}
\usedv{m4}{7}{\colorD}
\usedv{m4}{8}{\colorD}

\fith{m4}{2}{\colorE}
\fith{m4}{4}{\colorE}


% External coherence of depth 5
\drawMatrix[below=of m4]{5}
\fith[dotted]{m5}{2}{\colorE}
\fith[dotted]{m5}{4}{\colorE}
\usedv{m5}{2}{\colorB}
\usedv{m5}{4}{\colorB}
\usedv{m5}{5}{\colorB}
\usedh{m5}{3}{\colorC}
\usedh{m5}{6}{\colorC}
\usedh{m5}{7}{\colorC}
\usedv{m5}{6}{\colorD}
\usedv{m5}{7}{\colorD}
\usedv{m5}{8}{\colorD}
\usedh{m5}{2}{\colorE}
\usedh{m5}{4}{\colorE}

\fitv{m5}{3}{\colorF}


% External coherence of depth 5 - MAX
\connectionsMatrix[below=of m5]{m};
\node[draw, color=blue, circle, thick, inner sep=5pt] at (m-5-1) {};
\node[left=3pt of m, text width=3cm, align=center]
  {\textbf{Maximum \underline{depth $5$}} of external coherence reached
    for candidate $\tilde{c_i}$};

\usedv{m}{2}{\colorB}
\usedv{m}{4}{\colorB}
\usedv{m}{5}{\colorB}
\usedh{m}{3}{\colorC}
\usedh{m}{6}{\colorC}
\usedh{m}{7}{\colorC}
\usedv{m}{6}{\colorD}
\usedv{m}{7}{\colorD}
\usedv{m}{8}{\colorD}
\usedh{m}{2}{\colorE}
\usedh{m}{4}{\colorE}
\usedv{m}{3}{\colorF}

\end{tikzpicture}

\end{document}
